<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes" />
	<title>calcSprite</title>
	<style>
		@keyframes percent {
			from {width:100%; height:100%;}
			to {width:0; height:0;}
		}
		
		.result {visibility:hidden; opacity:0; transition-property:visibility, opacity; transition-duration:0.25s; transition-timing-function:linear;}
		.result.active {visibility:visible; opacity:1;}
		.result.active .icon {width:100%; height:100%; background-repeat:no-repeat; background-color:#000;}
		.result.percent.active .icon {animation:percent 5s linear infinite alternate both;}
	</style>
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script src="js/calcSprite.min.js"></script>
	<script>
		$(function() {
			var $spriteImage = $('#sprite_image'),
				$iconWidth = $('#icon_width'),
				$iconHeight = $('#icon_height'),
				$iconPositionX = $('#icon_position_x'),
				$iconPositionY = $('#icon_position_y'),
				$convertWidth = $('#convert_width'),
				$convertHeight = $('#convert_height'),
				$width = $('.width'),
				$height = $('.height'),
				$size = $('.size'),
				$position = $('.position'),
				$percent = $('#percent'),
				$result = $('.result'),
				$icon = $('.icon'),
				spriteImage = {
					src : '',
					width : 0,
					height : 0
				};

			function setResult(event) {
				//src가 있을 때
				if(spriteImage.src) {
					var convert = {
							width : parseFloat($convertWidth.val(), 10),
							height : parseFloat($convertHeight.val(), 10)
						},
						iconPosition = {
							x : $iconPositionX.val(),
							y : $iconPositionY.val()
						};

					//변환 넓이가 있을 때
					if(convert.width > 0) {
						convert.width += 'px';
					}else{
						convert.width = 0;
					}
					
					//변환 높이가 있을 때
					if(convert.height > 0) {
						convert.height += 'px';
					}else{
						convert.height = 0;
					}
					
					//원본 좌표에 x 값이 left 일 때
					if(iconPosition.x === 'left') {
						iconPosition.x = 0;
					}
					
					//원본 좌표에 y 값이 top 일 때
					if(iconPosition.y === 'top') {
						iconPosition.y = 0;
					}

					var result = {
							horizontal : calcSprite(spriteImage.width, $iconWidth.val(), convert.width, iconPosition.x),
							vertical : calcSprite(spriteImage.height, $iconHeight.val(), convert.height, iconPosition.y)
						},
						size = {
							pixel : '',
							percent : ''
						},
						position = {
							pixel : '',
							percent : ''
						}

					for(var i in result) {
						for(var j in result[i]) {
							//픽셀일 때
							if(j === 'pixel') {
								//좌표가 있을 때
								if(result[i][j].position) {
									result[i][j].position += 'px';
								}

								//크기가 있을 때
								if(result[i][j].size) {
									result[i][j].size += 'px';
								}
							}else{
								//좌표가 있을 때
								if(result[i][j].position) {
									result[i][j].position += '%';
								}

								//크기가 있을 때
								if(result[i][j].size) {
									result[i][j].size += '%';
								}
							}

							//가로일 때
							if(i === 'horizontal') {
								//좌표가 0일 때
								if(!result[i][j].position) {
									result[i][j].position = 'left';
								}
							}else{
								//좌표가 0일 때
								if(!result[i][j].position) {
									result[i][j].position = 'top';
								}
							}

							//공백 추가
							size[j] += result[i][j].size + ' ';
							position[j] += result[i][j].position + ' ';
						}
					}

					//퍼센트가 체크되어 있을 때
					if($percent.is(':checked')) {
						size = size.percent;
						position = position.percent;
					}else{
						size = size.pixel;
						position = position.pixel;
					}

					//마지막 공백 제거
					size = size.substring(0, size.length - 1);
					position = position.substring(0, position.length - 1);
					
					//공백 단위로 자르기
					var sizeSplit = size.split(' '),
						positionSplit = position.split(' ');

					//가로 크기와 세로 크기가 같을 때
					if(sizeSplit[0] === sizeSplit[1]) {
						size = sizeSplit[0];
					}

					//가로 위치와 세로 위치가 같을 때
					if(positionSplit[0] === positionSplit[1]) {
						position = positionSplit[0];
					}
					
					//결과 출력
					$result.addClass('active').css({
						width : convert.width,
						height : convert.height
					});
					
					//아이콘 생성
					$icon.css({
						backgroundImage : 'url(' + spriteImage.src + ')',
						backgroundSize : size,
						backgroundPosition : position
					});
					
					//css 생성
					$width.text(convert.width);
					$height.text(convert.height);
					$size.text(size);
					$position.text(position);
				}
			}
			
			//값 초기화
			$percent.prop('checked', false);
			$spriteImage.add($iconWidth).add($iconHeight).add($iconPositionX).add($iconPositionY).add($convertWidth).add($convertHeight).val('');
			
			//이미지 업로드
			$spriteImage.on('change', function(event) {
				var fileReader = new FileReader();

				fileReader.readAsDataURL(this.files[0]);
				fileReader.onloadend = function(event) {
					var image = new Image();
					
					image.src = event.target.result;

					$(image).on('load', function(event) {
						spriteImage.src = image.src;
						spriteImage.width = this.width;
						spriteImage.height = this.height;
						setResult(event);
					});
				};
			});
			
			//체크박스
			$percent.on('change', function(event) {
				$result.toggleClass(this.id);
				setResult(event);
			});
			
			//키를 눌렀을 때
			$iconWidth.add($iconHeight).add($iconPositionX).add($iconPositionY).add($convertWidth).add($convertHeight).on('keyup', setResult);
		});
	</script>
</head>
<body>
<h1>calcSprite</h1>
<ul>
	<li><label for="sprite_image">스프라이트 이미지</label> : <input type="file" id="sprite_image" accept="image/*" /></li>
	<li><label for="icon_width">아이콘 넓이</label> : <input type="text" id="icon_width" /></li>
	<li><label for="icon_height">아이콘 높이</label> : <input type="text" id="icon_height" /></li>
	<li><label for="icon_position_x">아이콘 좌표(x)</label> : <input type="text" id="icon_position_x" /></li>
	<li><label for="icon_position_y">아이콘 좌표(y)</label> : <input type="text" id="icon_position_y" /></li>
	<li><label for="convert_width">변환 넓이</label> : <input type="text" id="convert_width" /></li>
	<li><label for="convert_height">변환 높이</label> : <input type="text" id="convert_height" /></li>
	<li><label for="percent">퍼센트 : </label><input type="checkbox" id="percent" /></li>
</ul>
<h2>결과</h2>
<ul>
	<li>width:<span class="width">0</span>;</li>
	<li>height:<span class="height">0</span>;</li>
	<li>background-size:<span class="size">0</span>;</li>
	<li>background-position:<span class="position">left top</span>;</li>
</ul>
<div class="result">
	<div class="icon">&nbsp;</div>
</div>
</body>
</html>