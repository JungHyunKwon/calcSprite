<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes" />
	<title>calcSprite</title>
	<style>
		@keyframes percentage {
			from {width:100%; height:100%;}
			to {width:0; height:0;}
		}
		
		.result {visibility:hidden; opacity:0; transition-property:visibility, opacity; transition-duration:0.25s; transition-timing-function:linear;}
		.result.active {visibility:visible; opacity:1;}
		.result.active .icon {width:100%; height:100%; background-repeat:no-repeat; background-color:#000;}
		.result.percentage.active .icon {animation:percentage 5s linear infinite alternate both;}
	</style>
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script src="js/calcSprite.min.js"></script>
	<script>
		$(function() {
			var $image = $('#image'),
				$originalWidth = $('#original_width'),
				$originalHeight = $('#original_height'),
				$originalPositionX = $('#original_position_x'),
				$originalPositionY = $('#original_position_y'),
				$convertWidth = $('#convert_width'),
				$convertHeight = $('#convert_height'),
				$width = $('.width'),
				$height = $('.height'),
				$backgroundWidth = $('.background_width'),
				$backgroundHeight = $('.background_height'),
				$x = $('.x'),
				$y = $('.y'),
				$percentage = $('#percentage'),
				$result = $('.result'),
				$icon = $('.icon'),
				sprite = {
					src : '',
					width : 0,
					height : 0
				};

			function setResult(event) {
				//src가 있을때
				if(sprite.src) {
					var convert = {
							width : parseFloat($convertWidth.val(), 10),
							height : parseFloat($convertHeight.val(), 10)
						},
						originalPosition = {
							x : $originalPositionX.val(),
							y : $originalPositionY.val()
						};

					//변환넓이가 있을때
					if(convert.width > 0) {
						convert.width += 'px';
					}else{
						convert.width = 0;
					}
					
					//변환높이가 있을때
					if(convert.height > 0) {
						convert.height += 'px';
					}else{
						convert.height = 0;
					}
					
					//원본좌표에 x값이 left일때
					if(originalPosition.x === 'left') {
						originalPosition.x = 0;
					}
					
					//원본좌표에 y값이 top일때
					if(originalPosition.y === 'top') {
						originalPosition.y = 0;
					}

					var result = {
						horizontal : calcSprite(sprite.width, $originalWidth.val(), convert.width, originalPosition.x),
						vertical : calcSprite(sprite.height, $originalHeight.val(), convert.height, originalPosition.y)
					};
					
					for(var i in result) {
						for(var j in result[i]) {
							//픽셀일때
							if(j === 'pixel') {
								//좌표가 있을때
								if(result[i][j].position) {
									result[i][j].position += 'px';
								}

								//크기가 있을때
								if(result[i][j].size) {
									result[i][j].size += 'px';
								}
							}else{
								//좌표가 있을때
								if(result[i][j].position) {
									result[i][j].position += '%';
								}

								//크기가 있을때
								if(result[i][j].size) {
									result[i][j].size += '%';
								}
							}
							
							//가로일때
							if(i === 'horizontal') {
								//좌표가 0일때
								if(!result[i][j].position) {
									result[i][j].position = 'left';
								}
							}else{
								//좌표가 0일때
								if(!result[i][j].position) {
									result[i][j].position = 'top';
								}
							}
						}
					}

					//퍼센트가 체크되어있을때
					if($percentage.is(':checked')) {
						result.horizontal = result.horizontal.percentage;
						result.vertical = result.vertical.percentage;
					}else{
						result.horizontal = result.horizontal.pixel;
						result.vertical = result.vertical.pixel;
					}

					$result.addClass('active').css({
						width : convert.width,
						height : convert.height
					});
					
					$icon.css({
						backgroundImage : 'url(' + sprite.src + ')',
						backgroundSize : result.horizontal.size + ' ' + result.vertical.size,
						backgroundPosition : result.horizontal.position + ' ' + result.vertical.position
					});

					$width.text(convert.width);
					$height.text(convert.height);
					$backgroundWidth.text(result.horizontal.size);
					$backgroundHeight.text(result.vertical.size);
					$x.text(result.horizontal.position);
					$y.text(result.vertical.position);
				}
			}

			$percentage.prop('checked', false);
			$image.add($originalWidth).add($originalHeight).add($originalPositionX).add($originalPositionY).add($convertWidth).add($convertHeight).val('');

			$image.on('change', function(event) {
				var fileReader = new FileReader();

				fileReader.readAsDataURL(this.files[0]);
				fileReader.onloadend = function(event) {
					var image = new Image();
					
					image.src = event.target.result;

					$(image).on('load', function(event) {
						sprite.src = image.src;
						sprite.width = this.width;
						sprite.height = this.height;
						setResult(event);
					});
				};
			});

			$percentage.on('change', function(event) {
				$result.toggleClass(this.id);
				setResult(event);
			});

			$originalWidth.add($originalHeight).add($originalPositionX).add($originalPositionY).add($convertWidth).add($convertHeight).on('keyup', setResult);
		});
	</script>
</head>
<body>
<h1>calcSprite</h1>
<ul>
	<li><label for="image">이미지</label> : <input type="file" id="image" accept="image/*" /></li>
	<li><label for="original_width">원본넓이</label> : <input type="text" id="original_width" /></li>
	<li><label for="original_height">원본높이</label> : <input type="text" id="original_height" /></li>
	<li><label for="original_position_x">원본좌표(x)</label> : <input type="text" id="original_position_x" /></li>
	<li><label for="original_position_y">원본좌표(y)</label> : <input type="text" id="original_position_y" /></li>
	<li><label for="convert_width">변환넓이</label> : <input type="text" id="convert_width" /></li>
	<li><label for="convert_height">변환높이</label> : <input type="text" id="convert_height" /></li>
	<li><label for="percentage">퍼센트 : </label><input type="checkbox" id="percentage" /></li>
</ul>
<h2>결과</h2>
<ul>
	<li>width:<span class="width">0</span>;</li>
	<li>height<span class="height">0</span>;</li>
	<li>background-size:<span class="background_width">0</span> <span class="background_height">0</span>;</li>
	<li>background-position:<span class="x">left</span> <span class="y">top</span>;</li>
</ul>
<div class="result">
	<div class="icon">&nbsp;</div>
</div>
</body>
</html>