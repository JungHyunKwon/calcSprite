<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes" />
	<title>calcSprite</title>
	<style>
		@keyframes percent {
			from {width:100%; height:100%;}
			to {width:0; height:0;}
		}
		
		.result {visibility:hidden; opacity:0; transition-property:visibility, opacity; transition-duration:0.25s; transition-timing-function:linear;}
		.result.active {visibility:visible; opacity:1;}
		.result.active .icon {width:100%; height:100%; background-repeat:no-repeat; background-color:#000;}
		.result.percent.active .icon {animation:percent 5s linear infinite alternate;}
	</style>
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script src="js/calcSprite.min.js"></script>
	<script>
		/**
		 * @name 소수점 절사
		 * @param {number} decimal
		 * @return {string}
		 * @since 2018-07-13
		 */
		Number.prototype.toFixed = function(decimal) {
			var splitString = this.toString().split('.');
			
			//소수점이 있을 때
			if(splitString[1]) {
				splitString[1] = splitString[1].substring(0, decimal);
			}

			return splitString.join('.');
		};

		$(function() {
			var $spriteImage = $('#sprite_image'),
				$iconWidth = $('#icon_width'),
				$iconHeight = $('#icon_height'),
				$iconPositionX = $('#icon_position_x'),
				$iconPositionY = $('#icon_position_y'),
				$convertWidth = $('#convert_width'),
				$convertHeight = $('#convert_height'),
				$width = $('.width'),
				$height = $('.height'),
				$size = $('.size'),
				$position = $('.position'),
				$percent = $('#percent'),
				percent = $percent[0],
				$result = $('.result'),
				$icon = $('.icon'),
				spriteImage = {
					src : '',
					width : 0,
					height : 0
				};

			/**
			 * @name 결과 적용
			 * @param {object} event
			 * @since 2018-07-13
			 */
			function setResult(event) {
				//src가 있을 때
				if(spriteImage.src) {
					var convert = {
							width : parseFloat($convertWidth.val(), 10),
							height : parseFloat($convertHeight.val(), 10)
						},
						iconPosition = {
							x : $iconPositionX.val(),
							y : $iconPositionY.val()
						};

					//변환 넓이가 있을 때
					if(convert.width > 0) {
						convert.width += 'px';
					}else{
						convert.width = 0;
					}
					
					//변환 높이가 있을 때
					if(convert.height > 0) {
						convert.height += 'px';
					}else{
						convert.height = 0;
					}
					
					//원본 좌표에 x 값이 left 일 때
					if(iconPosition.x === 'left') {
						iconPosition.x = 0;
					}
					
					//원본 좌표에 y 값이 top 일 때
					if(iconPosition.y === 'top') {
						iconPosition.y = 0;
					}

					var size = {},
						position = {},
						result = {
							horizontal : calcSprite(spriteImage.width, $iconWidth.val(), convert.width, iconPosition.x),
							vertical : calcSprite(spriteImage.height, $iconHeight.val(), convert.height, iconPosition.y)
						};
					
					//가로에 대한 픽셀 크기가 있을 때
					if(result.horizontal.pixel.size) {
						result.horizontal.pixel.size = Math.round(result.horizontal.pixel.size) + 'px';
					}
					
					//세로에 대한 픽셀 크기가 있을 때
					if(result.vertical.pixel.size) {
						result.vertical.pixel.size = Math.round(result.vertical.pixel.size) + 'px';
					}
					
					//픽셀 크기 합성
					size.pixel = result.horizontal.pixel.size + ' ' + result.vertical.pixel.size;

					//가로에 대한 픽셀 좌표가 있을 때
					if(result.horizontal.pixel.position) {
						result.horizontal.pixel.position = Math.round(result.horizontal.pixel.position) + 'px';
					}else{
						result.horizontal.pixel.position = 'left';
					}
					
					//세로에 대한 픽셀 좌표가 있을 때
					if(result.vertical.pixel.position) {
						result.vertical.pixel.position = Math.round(result.vertical.pixel.position) + 'px';
					}else{
						result.vertical.pixel.position = 'top';	
					}
					
					//픽셀 위치 합성
					position.pixel = result.horizontal.pixel.position + ' ' + result.vertical.pixel.position;

					//가로에 대한 퍼센트 크기가 있을 때
					if(result.horizontal.percent.size) {
						result.horizontal.percent.size = parseFloat(result.horizontal.percent.size.toFixed(2), 10) + '%';
					}
					
					//세로에 대한 퍼센트 크기가 있을 때
					if(result.vertical.percent.size) {
						result.vertical.percent.size = parseFloat(result.vertical.percent.size.toFixed(2), 10) + '%';
					}
					
					//퍼센트 크기 합성
					size.percent = result.horizontal.percent.size + ' ' + result.vertical.percent.size;

					//가로에 대한 퍼센트 좌표가 있을 때
					if(result.horizontal.percent.position) {
						result.horizontal.percent.position = parseFloat(result.horizontal.percent.position.toFixed(2), 10) + '%';
					}else{
						result.horizontal.percent.position = 'left';
					}
					
					//세로에 대한 퍼센트 좌표가 있을 때
					if(result.vertical.percent.position) {
						result.vertical.percent.position = parseFloat(result.vertical.percent.position.toFixed(2), 10) + '%';
					}else{
						result.vertical.percent.position = 'top';	
					}
					
					//퍼센트 위치 합성
					position.percent = result.horizontal.percent.position + ' ' + result.vertical.percent.position;

					//퍼센트가 체크되어 있을 때
					if(percent.checked) {
						size = size.percent;
						position = position.percent;
						$result.addClass(percent.id);
					}else{
						size = size.pixel;
						position = position.pixel;
						$result.removeClass(percent.id);
					}
					
					//결과 출력
					$result.addClass('active').css({
						width : convert.width,
						height : convert.height
					});
					
					//아이콘 생성
					$icon.css({
						backgroundImage : 'url(' + spriteImage.src + ')',
						backgroundSize : size,
						backgroundPosition : position
					});
					
					//css 생성
					$width.text(convert.width);
					$height.text(convert.height);
					$size.text(size);
					$position.text(position);
				}
			}

			//이미지 업로드
			$spriteImage.on('change', function(event) {
				var fileReader = new FileReader();

				fileReader.readAsDataURL(this.files[0]);
				fileReader.onloadend = function(event) {
					var image = new Image();
					
					image.src = event.target.result;

					$(image).on('load', function(event) {
						spriteImage.src = image.src;
						spriteImage.width = this.width;
						spriteImage.height = this.height;
						setResult.call(this, event);
					});
				};
			}).triggerHandler('change');

			//체크박스
			$percent.on('change', setResult);

			//키를 눌렀을 때
			$iconWidth.add($iconHeight).add($iconPositionX).add($iconPositionY).add($convertWidth).add($convertHeight).on('keyup', setResult);
		});
	</script>
</head>
<body>
<h1>calcSprite</h1>
<ul>
	<li><label for="sprite_image">스프라이트 이미지</label> : <input type="file" id="sprite_image" accept="image/*" /></li>
	<li><label for="icon_width">아이콘 넓이</label> : <input type="text" id="icon_width" /></li>
	<li><label for="icon_height">아이콘 높이</label> : <input type="text" id="icon_height" /></li>
	<li><label for="icon_position_x">아이콘 좌표(x)</label> : <input type="text" id="icon_position_x" /></li>
	<li><label for="icon_position_y">아이콘 좌표(y)</label> : <input type="text" id="icon_position_y" /></li>
	<li><label for="convert_width">변환 넓이</label> : <input type="text" id="convert_width" /></li>
	<li><label for="convert_height">변환 높이</label> : <input type="text" id="convert_height" /></li>
	<li><label for="percent">퍼센트 : </label><input type="checkbox" id="percent" /></li>
</ul>
<h2>결과</h2>
<ul>
	<li>width:<span class="width">0</span>;</li>
	<li>height:<span class="height">0</span>;</li>
	<li>background-size:<span class="size">0 0</span>;</li>
	<li>background-position:<span class="position">left top</span>;</li>
</ul>
<div class="result">
	<div class="icon">&nbsp;</div>
</div>
</body>
</html>